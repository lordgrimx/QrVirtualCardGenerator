# cPanel Python Application .htaccess
# QR Virtual Card Backend API

# Enable passenger for Python application
PassengerEnabled On
PassengerAppRoot /home/sabrialp/api.sabrialperenkaya.com.tr
PassengerAppType wsgi
PassengerStartupFile passenger_wsgi.py

# Python version
PassengerPython /home/sabrialp/virtualenv/api.sabrialperenkaya.com.tr/3.12/bin/python3.12

# Environment variables
PassengerAppEnv production
PassengerFriendlyErrorPages off

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

# CORS headers for API
Header always set Access-Control-Allow-Origin "https://qr.sabrialperenkaya.com.tr"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
Header always set Access-Control-Allow-Credentials "true"

# Handle preflight requests
RewriteEngine On
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Error handling
ErrorDocument 500 "Internal Server Error - Please contact administrator"
ErrorDocument 404 "API Endpoint Not Found"

# Logging
CustomLog /home/sabrialp/logs/api_access.log combined
ErrorLog /home/sabrialp/logs/api_error.log

# Performance optimizations
ExpiresActive On
ExpiresByType application/json "access plus 1 minute"
ExpiresByType text/plain "access plus 1 minute"

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/javascript
</IfModule>

# Directory protection
<Files ~ "^\.">
    Order allow,deny
    Deny from all
</Files>

# Protect sensitive files
<FilesMatch "\.(env|py|pyc|pyo|log)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Allow specific Python files
<FilesMatch "^(passenger_wsgi|startup)\.py$">
    Order deny,allow
    Allow from all
</FilesMatch>
